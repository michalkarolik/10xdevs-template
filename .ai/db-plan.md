# Database Schema for AI Flashcard Generator

## 1. Tables

### users

| Column        | Type        | Constraints                             | Description                   |
| ------------- | ----------- | --------------------------------------- | ----------------------------- |
| id            | uuid        | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique identifier             |
| username      | text        | UNIQUE, NOT NULL                        | Username for login            |
| password_hash | text        | NOT NULL                                | Securely stored password      |
| created_at    | timestamptz | NOT NULL, DEFAULT now()                 | When account was created      |
| updated_at    | timestamptz | NOT NULL, DEFAULT now()                 | When account was last updated |

### topics

| Column     | Type        | Constraints                                      | Description                                    |
| ---------- | ----------- | ------------------------------------------------ | ---------------------------------------------- |
| id         | uuid        | PRIMARY KEY, DEFAULT uuid_generate_v4()          | Unique identifier                              |
| user_id    | uuid        | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | User who owns this topic                       |
| name       | text        | NOT NULL                                         | Name of the topic (e.g., "Biology", "History") |
| created_at | timestamptz | NOT NULL, DEFAULT now()                          | When topic was created                         |
| updated_at | timestamptz | NOT NULL, DEFAULT now()                          | When topic was last updated                    |

### flashcards

| Column     | Type        | Constraints                                                        | Description                        |
| ---------- | ----------- | ------------------------------------------------------------------ | ---------------------------------- |
| id         | uuid        | PRIMARY KEY, DEFAULT uuid_generate_v4()                            | Unique identifier                  |
| topic_id   | uuid        | NOT NULL, REFERENCES topics(id) ON DELETE CASCADE                  | Topic this flashcard belongs to    |
| front      | text        | NOT NULL, CHECK (char_length(front) <= 100)                        | Front side text (question/term)    |
| back       | text        | NOT NULL, CHECK (char_length(back) <= 500)                         | Back side text (answer/definition) |
| source     | varchar     | NOT NULL, CHECK(source in ('ai-generated', 'ai-edited', 'manual')) | Whether generated by AI            |
| created_at | timestamptz | NOT NULL, DEFAULT now()                                            | When flashcard was created         |
| updated_at | timestamptz | NOT NULL, DEFAULT now()                                            | When flashcard was last updated    |

## 2. Relationships

- A **user** can have many **topics** (one-to-many)
- A **topic** belongs to one **user** (many-to-one)
- A **topic** can have many **flashcards** (one-to-many)
- A **flashcard** belongs to one **topic** (many-to-one)

## 3. Indexes

```sql
-- Create indexes for better query performance
CREATE INDEX idx_topics_user_id ON topics(user_id);
CREATE INDEX idx_flashcards_topic_id ON flashcards(topic_id);

```

## 5. Design Notes

### learning_sessions

| Column     | Type        | Constraints                                      | Description                                |
| ---------- | ----------- | ------------------------------------------------ | ------------------------------------------ |
| id         | uuid        | PRIMARY KEY, DEFAULT uuid_generate_v4()          | Unique identifier for the learning session |
| user_id    | uuid        | NOT NULL, REFERENCES users(id) ON DELETE CASCADE | Foreign key referencing the user           |
| created_at | timestamptz | NOT NULL, DEFAULT now()                          | When the learning session was created      |

### learning_session_flashcards

| Column              | Type        | Constraints                                                  | Description                                                |
| ------------------- | ----------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| id                  | uuid        | PRIMARY KEY, DEFAULT uuid_generate_v4()                      | Unique identifier for the learning session flashcard entry |
| learning_session_id | uuid        | NOT NULL, REFERENCES learning_sessions(id) ON DELETE CASCADE | Foreign key referencing the learning session               |
| flashcard_id        | uuid        | NOT NULL, REFERENCES flashcards(id) ON DELETE CASCADE        | Foreign key referencing the flashcard                      |
| user_response       | text        | NOT NULL CHECK (user_response IN ('Again', 'Hard', 'Easy'))  | User's response to the flashcard                           |
| created_at          | timestamptz | NOT NULL, DEFAULT now()                                      | When the response was recorded                             |

### 6. Indexes

CREATE INDEX idx_learning_sessions_user_id ON learning_sessions(user_id);
CREATE INDEX idx_learning_session_flashcards_learning_session_id ON learning_session_flashcards(learning_session_id);
CREATE INDEX idx_learning_session_flashcards_flashcard_id ON learning_session_flashcards(flashcard_id);

### 6. Indexes

CREATE INDEX idx_learning_session_flashcard_id ON learning_session(flashcard_id);
CREATE INDEX idx_learning_session_user_response ON learning_session(user_response);
